# Lab2

## 实验目的

* 本次实验我们需要实现如下的特殊的斐波那契数列:

$$
F(N)=F(N-2)\%p+F(N-1)\%q
$$

$$
p=2^k(2\leq k\leq 10), 10\leq q\leq 1024
$$

* 本次实验我们希望能熟悉汇编指令
* 熟悉LC3 TOOL的使用方法

## 实验原理

* 因为LC3没有原生的减法指令，所以我们采用了如下的方式实现`R2=R1-R0`
  ```assembly
  NOT R3, R0
  ADD R3, R3, #1
  ADD R2, R1, R3
  ```

* 同理LC3没有原生的mod指令，我们采用如下的方式实现`R2 = R1 mod R0`

```assembly
	 NOT R3, R0
	 ADD R3, R3, #1
LOOP ADD R1, R1, R3 ;先执⾏减法操作
     BRzp LOOP ;如果得到的数是⼤于等于零的，继续执⾏减法操作，直到得到⼩于等于零的结果
     ADD R2, R1, R0 ;得到最后的取模的值
```

* 我们自定义了两个地址`a_n`和`a_n+1`用于存储每次计算后的结果
  我们将`a_n`和`a_n+1`在每次计算出结果后更新
* 需要初始化R2的值，因为我们不是从`N=0`开始算起的

## 实验过程

本次实验较为简单，仅有两处debug的过程

1. 第一处在于设置`LABEL`的时候，未充分考虑到`offset`的大小限制，导致了编译失败，重新更改`LD`的位置即可解决！
2. 第二处在于未充分考虑到`N`是从2开始的，不需要循环N次，需要对`N`进行初始化

## 实验结果

1. $N=100, p=256, q=123$
![](.\figs\1.png)
1. $N=200,p=512,q=456$
![](.\figs\2.png)
2. $N=300,p=1024,q=789$
![](.\figs\3.png)

## Answer to the question: 

How can you improve the efficiency of loop structure in your program?

* 我们使用了两个地址来存取$a_n$和$a_{n+1}$的值，避免了过多寄存器的使用，以及方便程序的编写和理解
* 我们在每次循环中只需正确维护$a_n$和$a_{n+1}$的值即可，其中$a_n$的值很好维护，只需要将其等于上一个$a_{n+1}$即可
* 我们对与$a_n$和$a_{n+1}$分别取模，相加即可得到最终的值